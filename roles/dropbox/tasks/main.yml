---
# Dropbox
# (https://www.digitalocean.com/community/tutorials/how-to-install-dropbox-client-as-a-service-on-ubuntu-14-04)
- name: Install required packages 
  apt: 
    name: "{{item}}"
    update_cache: yes
  with_items: 
    - libxml2-dev
    - libxslt1-dev
    - python-dev
    - libxxf86vm-dev
    - libxdamage-dev
    - libxrender-dev
    - libxcomposite-dev
    - libxext-dev
    - libxxf86vm-dev
 
- name: Create dropbox folder
  file:
    path: /opt/dropbox
    state: directory
    mode: 0755

- name: Download dropbox archive
  get_url:
    url: https://www.dropbox.com/download?plat=lnx.x86_64
    dest: /tmp/dropbox-linux-x86_64.tar.gz

# unarchive does not work...
- command: tar xzfv /tmp/dropbox-linux-x86_64.tar.gz --strip 1 -C /opt/dropbox

- shell: export DISPLAY=""

- command: /opt/dropbox/dropboxd
# TODO: user interaction

- debug:
    msg: "Link computer --> <STRG>+C"

- name: Download file and force basic auth
  get_url:
    url: https://gist.githubusercontent.com/thisismitch/d0133d91452585ae2adc/raw/699e7909bdae922201b8069fde3011bbf2062048/dropbox
    dest: /etc/init.d/dropbox
    mode: "+x"
 
- debug:
    msg: 'sudo nano /etc/default/dropbox -> DROPBOX_USERS="openhab" -> STRG+X'

- debug:
    msg: "sudo update-rc.d dropbox defaults"
    
- debug:
    msg: "sudo service dropbox start"
